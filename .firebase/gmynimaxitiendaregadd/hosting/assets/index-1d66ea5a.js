import{initializeApp as P}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";import{getAuth as A,GoogleAuthProvider as u,signInWithRedirect as F,getRedirectResult as C,onAuthStateChanged as I}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";import{getDatabase as v,ref as a,onValue as B,set as h}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();const W=document.getElementById("ejecutarFuncion"),$=document.getElementById("textwhpform"),E=document.getElementById("resultado"),j=document.getElementById("textwhpform"),J=document.getElementById("resultado"),G=document.getElementById("idresout"),V=document.getElementById("idjsondata"),q=document.getElementById("idinfo");cmdlimpiar.addEventListener("click",()=>{j.value="",J.value="",G.value="",V.innerText="",idresout.innerText="(Resultado Registro Whp Form...)",q.innerText="Info.."});W.addEventListener("click",()=>{const o=$.value,t=b(o);E.innerText=""+t,E.value=t});function z(o,t){let i=o,c="";for(let e=0;e<t.length;e++){e>1&&(c=",");const n=t[e];for(;i.indexOf(n)!==-1;)i=i.replace(n,c)}return i.trim()}function b(o){const t=["*Plantilla de contacto*","*Respuesta* #","*Nombre :*","*Correo electrónico :*","*Whatsapp :*","*Preferencias :*","*Observaciones :*"],i=z(o,t);return K(o,t),""+i}function K(o,t){let i=o,c="",e=[];for(let n=0;n<t.length;n++){n>1&&(c=",");const r=t[n];for(;i.indexOf(r)!==-1;)i=i.replace(r,c)}return i.split(","),{resultadoFinal:i.trim(),resultadosIntermedios:e}}const Q=document.getElementById("textwhpform"),x=P({apiKey:"AIzaSyApf3ZmNqhjhIVSRWV7BNISx4H2YIBwT6Q",authDomain:"gmynimaxitiendaregadd.firebaseapp.com",databaseURL:"https://gmynimaxitiendaregadd-default-rtdb.firebaseio.com",projectId:"gmynimaxitiendaregadd",storageBucket:"gmynimaxitiendaregadd.firebasestorage.app",messagingSenderId:"835030557718",appId:"1:835030557718:web:7045e20c0d741b817a8137",measurementId:"G-SJBQEZNLJJ"}),s=A(x),U=new u(x),k=document.getElementById("accedergoogle"),w=document.getElementById("cerrarsesion"),Y=document.getElementById("emailinisesion"),Z=document.getElementById("logininac"),_=document.getElementById("loginac"),y=document.getElementById("idinfo"),H=document.getElementById("loginactivo"),M=document.getElementById("cmdlimpiar"),X=document.getElementById("textwhpform"),D=document.getElementById("resultado"),ee=document.getElementById("idresout"),te=document.getElementById("cmdgrabaregcontacti");k.addEventListener("click",o=>{F(s,U),C(s).then(t=>{u.credentialFromResult(t).accessToken,t.user}).catch(t=>{t.code,t.message,u.credentialFromError(t)})});w.addEventListener("click",o=>{s.signOut().then(()=>{document.getElementById("login").style.display="block",document.getElementById("accedergoogle").style.display="block",document.getElementById("cerrarsesion").style.display="none",document.getElementById("emailinisesion").innerText="Email"}).catch(t=>{console.error("Error al cerrar sesión:",t)})});I(s,o=>{if(o){const t=o.uid,i=o.displayName,c=o.email,e=btoa(c),n=v(),r=a(n,"usuario/idkey:"+e);B(r,l=>{if(l.val()!==null)document.getElementById("login").style.display="none",document.getElementById("loginactivo").style.display="block",document.getElementById("accedergoogle").style.display="none",document.getElementById("cerrarsesion").style.display="block",document.getElementById("emailinisesion").innerText=c,document.getElementById("logininac").style.display="none";else{document.getElementById("login").style.display="block",document.getElementById("loginactivo").style.display="none",document.getElementById("cerrarsesion").style.display="none",document.getElementById("emailinisesion").innerText="Email",document.getElementById("logininac").style.display="block";const m="usuario/idkey:"+e;h(a(n,m),{nombre:i,email:c,key:t,idrol:4,idnivel:2})}})}else k.style.display="block",H.style.display="none",Y.style.display="none",w.style.display="none",Z.style.display="block",_.style.display="none"});M.addEventListener("click",()=>{X.value="",D.value="",y.innerText="Info ...",ee.innerText="(Resultado Registro Whp Form...)"});te.addEventListener("click",()=>{I(s,o=>{if(o){var t=document.getElementById("idresout");o.uid,o.displayName;const L=o.email;var i=btoa(L),c=b(Q.value),e=[];e=c.split(",");var n=e[0].trim()+"_"+i,r=e[1].trim(),l=e[2].trim(),p=e[3].trim(),m=e[4].trim(),R=e[5].trim();const f=v(),N=a(f,"usuario/respuesta:"+n);B(N,O=>{O.val();var S="usuario/respuesta:"+n;h(a(f,S),{nombre:r,correoelectronico:l,whatsapp:p,preferencias:m,observaciones:R})}),y.innerText="Registro Grabado Correctamente";for(var T=["Respuesta #","Nombre","Correo electronico","Whatsapp","Preferencias","Observaciones"],g={},d=0;d<e.length;d++)g[T[d]]=e[d];t.innerText=e[0]+""+JSON.stringify(g,null,2)}else y.innerText="Usuario no autenticado."})});
