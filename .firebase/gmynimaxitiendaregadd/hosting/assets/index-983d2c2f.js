import{initializeApp as P}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";import{getAuth as A,GoogleAuthProvider as u,onAuthStateChanged as I,signInWithRedirect as F,getRedirectResult as C}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";import{getDatabase as v,ref as d,onValue as h,set as b}from"https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();const W=document.getElementById("ejecutarFuncion"),j=document.getElementById("textwhpform"),E=document.getElementById("resultado"),J=document.getElementById("textwhpform"),G=document.getElementById("resultado"),U=document.getElementById("idresout"),V=document.getElementById("idjsondata"),q=document.getElementById("idinfo");cmdlimpiar.addEventListener("click",()=>{J.value="",G.value="",U.value="",V.innerText="",idresout.innerText="(Resultado Registro Whp Form...)",q.innerText="Info.."});W.addEventListener("click",()=>{const o=j.value,t=B(o);E.innerText=""+t,E.value=t});function z(o,t){let i=o,r="";for(let e=0;e<t.length;e++){e>1&&(r=",");const n=t[e];for(;i.indexOf(n)!==-1;)i=i.replace(n,r)}return i.trim()}function B(o){const t=["*Plantilla de contacto*","*Respuesta* #","*Nombre :*","*Correo electrónico :*","*Whatsapp :*","*Preferencias :*","*Observaciones :*"],i=z(o,t);return K(o,t),""+i}function K(o,t){let i=o,r="",e=[];for(let n=0;n<t.length;n++){n>1&&(r=",");const s=t[n];for(;i.indexOf(s)!==-1;)i=i.replace(s,r)}return i.split(","),{resultadoFinal:i.trim(),resultadosIntermedios:e}}const Q=document.getElementById("textwhpform"),x=P({apiKey:"AIzaSyApf3ZmNqhjhIVSRWV7BNISx4H2YIBwT6Q",authDomain:"gmynimaxitiendaregadd.firebaseapp.com",databaseURL:"https://gmynimaxitiendaregadd-default-rtdb.firebaseio.com",projectId:"gmynimaxitiendaregadd",storageBucket:"gmynimaxitiendaregadd.firebasestorage.app",messagingSenderId:"835030557718",appId:"1:835030557718:web:7045e20c0d741b817a8137",measurementId:"G-SJBQEZNLJJ"}),a=A(x),Y=new u(x),T=document.getElementById("accedergoogle"),k=document.getElementById("cerrarsesion"),Z=document.getElementById("emailinisesion"),_=document.getElementById("logininac"),$=document.getElementById("loginac");document.getElementById("sliderinisesion");const y=document.getElementById("idinfo");cmdgrabaregcontacti.addEventListener("click",()=>{I(a,o=>{if(o){var t=document.getElementById("idresout");o.uid,o.displayName;const R=o.email;var i=btoa(R),r=B(Q.value),e=[];e=r.split(",");var n=e[0].trim()+"_"+i,s=e[1].trim(),l=e[2].trim(),p=e[3].trim(),m=e[4].trim(),L=e[5].trim();const f=v(),w=d(f,"usuario/respuesta:"+n);h(w,O=>{O.val();var S="usuario/respuesta:"+n;b(d(f,S),{nombre:s,correoelectronico:l,whatsapp:p,preferencias:m,observaciones:L})}),y.innerText="Registro Grabado Correctamente";for(var N=["Respuesta #","Nombre","Correo electronico","Whatsapp","Preferencias","Observaciones"],g={},c=0;c<e.length;c++)g[N[c]]=e[c];t.innerText=e[0]+""+JSON.stringify(g,null,2)}else y.innerText="Usuario no autenticado."})});T.addEventListener("click",o=>{F(a,Y),C(a).then(t=>{u.credentialFromResult(t).accessToken,t.user}).catch(t=>{t.code,t.message,u.credentialFromError(t)})});k.addEventListener("click",o=>{a.signOut().then(()=>{document.getElementById("login").style.display="block",document.getElementById("accedergoogle").style.display="block",document.getElementById("cerrarsesion").style.display="none",document.getElementById("emailinisesion").innerText="Email"}).catch(t=>{console.error("Error al cerrar sesión:",t)})});I(a,o=>{if(o){const t=o.uid,i=o.displayName,r=o.email,e=btoa(r),n=v(),s=d(n,"usuario/idkey:"+e);h(s,l=>{if(l.val()!==null)y.innerText="Usuario autenticado. "+r,document.getElementById("login").style.display="none",document.getElementById("loginactivo").style.display="block",document.getElementById("accedergoogle").style.display="none",document.getElementById("cerrarsesion").style.display="block",document.getElementById("emailinisesion").innerText=r;else{document.getElementById("login").style.display="block",document.getElementById("loginactivo").style.display="none",document.getElementById("cerrarsesion").style.display="none",document.getElementById("emailinisesion").innerText="Email",console.log("No hay un valor en el nodo");const m="usuario/idkey:"+e;b(d(n,m),{nombre:i,email:r,key:t,idrol:4,idnivel:2})}})}else T.style.display="block",loginactivo.style.display="none",Z.style.display="none",k.style.display="none",_.style.display="block",$.style.display="none"});
